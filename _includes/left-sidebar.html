{% comment %}
Right Sidebar: Categories → Posts (oldest first)
- Sections = FIRST category of each post
- Inside each section: posts sorted by date ASC (oldest → newest)
- No config.yml mapping, no per-post front matter beyond categories/title/date
- Active link gets .active when page.url matches
{% endcomment %}

<aside class="sidebar-right" id="sidebar-right">
  <div class="sidebar-right-content">
    <nav class="sidebar-nav">

      {%- assign posts_with_cat = site.posts | where_exp: "p", "p.categories and p.categories.size > 0" -%}
      {%- if posts_with_cat.size > 0 -%}

        {%- comment -%} Group by first category and sort sections alphabetically {%- endcomment -%}
        {%- assign grouped = posts_with_cat | group_by_exp: "p", "p.categories | first" -%}
        {%- assign grouped = grouped | sort: "name" -%}

        <ul class="category-groups">
          {%- for group in grouped -%}
            <li class="nav-category">{{ group.name }}</li>

            {%- comment -%} Oldest → newest inside the section {%- endcomment -%}
            {%- assign items = group.items | sort: "date" -%}

            {%- for post in items -%}
              {%- assign is_active = page.url == post.url -%}
              <li class="nav-link{% if is_active %} active{% endif %}">
                <a href="{{ post.url | relative_url }}">
                  {{ post.title }}
                </a>
                {%- comment -%}
                Optional tiny date (uncomment if you want it):
                <small class="post-date">{{ post.date | date: "%Y-%m-%d" }}</small>
                {%- endcomment -%}
              </li>
            {%- endfor -%}
          {%- endfor -%}
        </ul>

      {%- else -%}
        <p class="empty-state">No posts found with categories.</p>
      {%- endif -%}
    </nav>
  </div>
</aside>
