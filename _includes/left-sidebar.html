{%- capture current_url -%}
  {{ page.url | relative_url | split:"?" | first | replace:"index.html","" | replace:"//","/" }}
{%- endcapture -%}
{%- assign current_url = current_url | strip -%}
{%- if current_url != "/" and current_url != "" and current_url contains "/" -%}
  {%- assign current_url = current_url | append:"/" | replace:"//","/" -%}
{%- endif -%}

<ul class="main-nav">
  {%- for item in site.navigation_header -%}
    {%- assign item_url = item.url | relative_url | split:"?" | first | replace:"index.html","" | replace:"//","/" | strip -%}
    {%- if item_url != "/" and item_url != "" and item_url contains "/" -%}
      {%- assign item_url = item_url | append:"/" | replace:"//","/" -%}
    {%- endif -%}
    <li class="nav-link{% if current_url == item_url %} active{% endif %}">
      <a href="{{ item.url | relative_url }}">
        <i class="ph-duotone ph-{{ item.icon | default: 'house' }}"></i>{{ item.title }}
      </a>
    </li>
  {%- endfor -%}
</ul>

{%- assign grouped = site.posts | group_by_exp: 'p', 'p.categories | first' -%}
{%- assign clean_groups = "" | split: "" -%}
{%- for g in grouped -%}
  {%- if g.name and g.name != "" -%}
    {%- assign clean_groups = clean_groups | push: g -%}
  {%- endif -%}
{%- endfor -%}
{%- assign clean_groups = clean_groups | sort: 'name' -%}

<ul>
  {%- for group in clean_groups -%}
    <li class="nav-category">{{ group.name }}</li>
    {%- assign items_sorted = group.items | sort: 'date' -%}
    {%- for post in items_sorted -%}
      {%- assign post_url = post.url | relative_url | split:"?" | first | replace:"index.html","" | replace:"//","/" | strip -%}
      {%- if post_url != "/" and post_url != "" and post_url contains "/" -%}
        {%- assign post_url = post_url | append:"/" | replace:"//","/" -%}
      {%- endif -%}
      <li class="nav-link{% if current_url == post_url %} active{% endif %}">
        <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
      </li>
    {%- endfor -%}
  {%- endfor -%}
</ul>
