
<div class="search-overlay">
  <div class="search-modal">

    <header class="search-modal__header">
      <h1 class="search-modal__title">Search the Site</h1>
      <a href="javascript:history.back()" class="search-modal__close-btn" title="Close Search">&times;</a>
    </header>

    <div class="search-input-group">
      <i class="ph-magnifying-glass search-input-icon"></i>
      <input class="search-input" id="site-search-input" type="search" placeholder="Start typing to find anything..." autocomplete="off" autofocus />
    </div>

    <div class="search-results-wrapper" id="search-results-wrapper">
      <div class="search-results-placeholder">
        <i class="ph-text-aa-bold placeholder-icon"></i>
        <p>Results will appear here as you type</p>
      </div>
    </div>

  </div>
</div>

<script type="text/javascript" src="{{ "/assets/scripts/fetch.js" | relative_url }}"></script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const endpoint = '{{ "/assets/search.json" | relative_url }}';
    const pages = [];
    let isDataFetched = false;

    // Fetch the search data
    fetch(endpoint)
      .then(blob => blob.json())
      .then(data => {
        pages.push(...data);
        isDataFetched = true;
      });

    const searchInput = document.getElementById('site-search-input');
    const resultsWrapper = document.getElementById('search-results-wrapper');

    // Guard clause to ensure elements exist
    if (!searchInput || !resultsWrapper) {
      console.error('Search input or results wrapper not found.');
      return;
    }

    function findResults(termToMatch, pages) {
      const regex = new RegExp(termToMatch, 'gi');
      return pages.filter(item => item.title.match(regex) || item.content.match(regex));
    }

    function displayResults() {
      if (!isDataFetched) return; // Don't search until data is loaded

      const searchTerm = this.value.trim();

      if (searchTerm.length < 2) {
        resultsWrapper.innerHTML = `
          <div class="search-results-placeholder">
            <i class="ph-text-aa-bold placeholder-icon"></i>
            <p>Results will appear here as you type</p>
          </div>`;
        return;
      }

      const resultsArray = findResults(searchTerm, pages);

      if (resultsArray.length > 0) {
        const html = resultsArray.map(item => {
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = item.excerpt;
          const cleanExcerpt = (tempDiv.textContent || tempDiv.innerText || "").trim();

          return `
            <a href="${item.url}" class="search-result-card">
              <h4 class="search-result-card__title">${item.title}</h4>
              <p class="search-result-card__excerpt">${cleanExcerpt}</p>
            </a>`;
        }).join('');
        resultsWrapper.innerHTML = `<div class="search-results-grid">${html}</div>`;
      } else {
        resultsWrapper.innerHTML = `
          <div class="search-no-results">
            <i class="ph-x-circle no-results-icon"></i>
            <h4>No Results Found</h4>
            <p>Sorry, we couldn't find anything for "${searchTerm}".</p>
          </div>`;
      }
    }

    searchInput.addEventListener('keyup', displayResults);
    searchInput.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') event.preventDefault();
    });
  });
</script>
<noscript>A JavaScript-enabled browser is required to use this search feature.</noscript>