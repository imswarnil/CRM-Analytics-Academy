<div class="search-overlay-container">

  <div class="search-modal">

    <header class="search-modal__header">
      <h1 class="search-modal__title">Search</h1>
      <p class="search-modal__description">Find anything on the site instantly.</p>
    </header>

    <div class="search-input-group">
      <i class="ph-magnifying-glass search-input-icon"></i>
      <input class="search-input" id="site-search-input" type="search" name="search" placeholder="Type to search..." autocomplete="off" autofocus />
    </div>

    <div class="search-results-wrapper" id="search-results-wrapper">
      <!-- Search results will be injected here by JavaScript -->
      <div class="search-results-placeholder">
        <i class="ph-text-aa-bold placeholder-icon"></i>
        <p>Start typing to see results</p>
      </div>
    </div>

  </div>

</div>

<script type="text/javascript" src="{{ "/assets/scripts/fetch.js" | relative_url }}"></script>
<script type of="text/javascript">
  const endpoint = '{{ "/assets/search.json" | relative_url }}';
  const pages = [];

  fetch(endpoint)
    .then(blob => blob.json())
    .then(data => pages.push(...data));

  function findResults(termToMatch, pages) {
    return pages.filter(item => {
      const regex = new RegExp(termToMatch, 'gi');
      return item.title.match(regex) || item.content.match(regex);
    });
  }

  function displayResults() {
    const resultsWrapper = document.getElementById('search-results-wrapper');
    const searchTerm = this.value.trim();

    // Show placeholder if input is too short or empty
    if (searchTerm.length < 2) {
      resultsWrapper.innerHTML = `
        <div class="search-results-placeholder">
          <i class="ph-text-aa-bold placeholder-icon"></i>
          <p>Start typing to see results</p>
        </div>`;
      return;
    }

    const resultsArray = findResults(searchTerm, pages);

    if (resultsArray.length > 0) {
      const html = resultsArray.map(item => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = item.excerpt;
        const cleanExcerpt = (tempDiv.textContent || tempDiv.innerText || "").trim();

        return `
          <a href="${item.url}" class="search-result-card">
            <h4 class="search-result-card__title">${item.title}</h4>
            <p class="search-result-card__excerpt">${cleanExcerpt}</p>
          </a>`;
      }).join('');
      resultsWrapper.innerHTML = `<div class="search-results-grid">${html}</div>`;
    } else {
      resultsWrapper.innerHTML = `
        <div class="search-no-results">
          <i class="ph-x-circle no-results-icon"></i>
          <h4>No Results Found</h4>
          <p>Sorry, we couldn't find anything for "${searchTerm}".</p>
        </div>`;
    }
  }

  const searchInput = document.querySelector('#site-search-input');
  searchInput.addEventListener('keyup', displayResults);
  searchInput.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      // Optional: redirect to the first search result on Enter
      const firstResultLink = document.querySelector('.search-result-card');
      if (firstResultLink) {
        window.location.href = firstResultLink.href;
      }
    }
  });
</script>
<noscript>Please enable JavaScript to use the search form.</noscript>