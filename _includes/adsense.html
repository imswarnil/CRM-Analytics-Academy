{%- comment -%}
================================================================================
  Simple AdSense Component with Lazy Loading & Self-Contained Styles
  - Usage: {% include adsense.html type="[TYPE]" %}
  - Available types: square, leaderboard, skyscraper, article
================================================================================
{%- endcomment -%}

{%- assign ad_type = include.type -%}
{%- assign publisher_id = site.adsense.publisher_id | default: "ca-pub-1291242080282540" -%}

{%- comment -%} --- Map type to the correct Slot ID --- {%- endcomment -%}
{%- case ad_type -%}
  {%- when "square" -%}
    {%- assign slot_id = "7663977887" -%}
  {%- when "leaderboard" -%}
    {%- assign slot_id = "8939839370" -%}
  {%- when "skyscraper" -%}
    {%- assign slot_id = "3487917390" -%}
  {%- when "article" -%}
    {%- assign slot_id = "6501428979" -%}
  {%- else -%}
    {%- assign slot_id = nil -%}
{%- endcase -%}


{%- if site.adsense.enabled and slot_id -%}

  {%- comment -%} --- Renders CSS (ONCE per page) --- {%- endcomment -%}
  {%- unless page.adsense_styles_rendered -%}
  <style>
    .crma-ad-wrap{--_bg:var(--crma-secondary,hsl(210,50%,96%));--_bd:var(--crma-border,hsl(210,30%,90%));margin:2rem auto;background:var(--_bg);border:1px solid var(--_bd);border-radius:var(--crma-radius,.75rem);padding:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}.crma-ad-wrap[data-ad-type=leaderboard]{min-height:90px;max-width:980px}.crma-ad-wrap[data-ad-type=square]{min-height:250px;max-width:336px}.crma-ad-wrap[data-ad-type=skyscraper]{display:none;min-height:600px;max-width:300px}@media (min-width:1024px){.crma-ad-wrap[data-ad-type=skyscraper]{display:flex}}.crma-ad-wrap[data-ad-type=article]{min-height:280px;border:none;background:0 0;padding:0}.crma-ad-wrap .adsbygoogle{display:block;width:100%;height:100%}html.dark .crma-ad-wrap{--_bg:var(--crma-secondary,hsl(216,35%,18%));--_bd:var(--crma-border,hsl(216,30%,25%))}
  </style>
  {%- assign page.adsense_styles_rendered = true -%}
  {%- endunless -%}

  {%- comment -%} --- The Ad Unit HTML --- {%- endcomment -%}
  <div class="crma-ad-wrap" data-ad-type="{{ ad_type }}" data-lazy-ad-unit>
    {%- if ad_type == "article" -%}
      <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="{{ publisher_id }}"
          data-ad-slot="{{ slot_id }}"></ins>
    {%- else -%}
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="{{ publisher_id }}"
          data-ad-slot="{{ slot_id }}"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
    {%- endif -%}
  </div>

  {%- comment -%} --- Renders Lazy-Loading Script (ONCE per page) --- {%- endcomment -%}
  {%- unless page.adsense_script_rendered -%}
  <script>
    document.addEventListener("DOMContentLoaded",function(){if(window.adObserver)return;const e=document.querySelectorAll("[data-lazy-ad-unit]");if(!e.length)return;const t=new IntersectionObserver((e,d)=>{e.forEach(e=>{if(e.isIntersecting){const s=e.target;if(s.dataset.adLazyLoaded)return;const a=s.querySelector(".adsbygoogle");if(a){s.dataset.adLazyLoaded="true";try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(e){console.error("Adsense error:",e)}}d.unobserve(s)}})},{rootMargin:"0px 0px 200px 0px"});window.adObserver=t,e.forEach(e=>{t.observe(e)})});
  </script>
  {%- assign page.adsense_script_rendered = true -%}
  {%- endunless -%}

{%- endif -%}